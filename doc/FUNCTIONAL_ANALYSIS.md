# 기능 분석 보고서 (Functional Analysis Report)

본 문서는 `controlVolumeByMouse.ahk` 스크립트의 주요 기능과 내부 동작 원리에 대한 상세 분석을 포함합니다.

## 목차 (Table of Contents)
1. [개요](#개요)
2. [핵심 기능](#핵심-기능)
3. [상세 구현 분석](#상세-구현-분석)
4. [시스템 트리거 및 이벤트](#시스템-트리거-및-이벤트)
5. [확장성 및 개선 제안](#확장성-및-개선-제안)

---

## 개요
이 프로젝트는 Windows 환경에서 마우스 휠을 사용하여 시스템 볼륨을 직관적으로 조절할 수 있게 해주는 AutoHotkey v2.0 기반 유틸리티입니다. 특히 작업 표시줄(Taskbar) 영역을 감지하여 해당 영역 위에서만 동작하도록 설계되었습니다.

## 핵심 기능
- **작업 표시줄 기반 볼륨 조절**: 마우스 커서가 작업 표시줄 위에 있을 때만 휠 스크롤을 통해 볼륨을 증감시킵니다.
- **다중 모니터 지원**: 주 모니터뿐만 아니라 보조 모니터의 작업 표시줄도 정확히 감지하여 모든 화면에서 동일한 편의성을 제공합니다.
- **동적 영역 감지**: 모니터 연결/해제 또는 해상도 변경 시 (`WM_DISPLAYCHANGE`) 자동으로 작업 표시줄 위치를 다시 계산합니다.
- **수동 업데이트**: `F12` 키를 통해 사용자가 즉시 작업 표시줄 정보를 갱신할 수 있습니다.

## 상세 구현 분석

### 1. 작업 표시줄 정보 수집 (`GetTaskbarInfo`)
스크립트는 두 가지 클래스 이름을 통해 작업 표시줄을 찾습니다:
- `ahk_class Shell_TrayWnd`: 주 작업 표시줄
- `ahk_class Shell_SecondaryTrayWnd`: 보조 모니터의 작업 표시줄

`WinGetPos`를 사용하여 각 작업 표시줄의 X, Y 좌표와 너비, 높이를 수집하고 전역 배열 `Taskbars`에 객체 형태로 저장합니다.

### 2. 마우스 위치 검증 (`MouseInTaskbar`)
핫키가 활성화되기 전 매번 실행되는 조건문입니다.
- 마우스의 현재 절대 좌표(`MouseGetPos`)를 가져옵니다.
- 저장된 `Taskbars` 배열을 순회하며 마우스가 특정 작업 표시줄 영역 안에 있는지 확인합니다.
- `margin (5px)`을 두어 작업 표시줄 경계 근처에서의 오동작을 방지하고 클릭 감도를 높였습니다.

### 3. 볼륨 조절 로직 (`AdjustVolume`)
- `Send "{Volume_Up}"`: 시스템 볼륨 증가 명령 전송
- `Send "{Volume_Down}"`: 시스템 볼륨 감소 명령 전송
- Windows 기본 볼륨 조절 인터페이스(OSD)와 연동됩니다.

## 시스템 트리거 및 이벤트
스크립트는 시스템과의 상호작용을 최적화하기 위해 다음 이벤트를 활용합니다.

- **초기화**: 스크립트 실행 후 100ms 뒤 `InitializeScript` 실행.
- **주기적 업데이트**: 10초마다 `TaskbarUpdateInterval`에 따라 영역 정보 최신화.
- **Windows 메시지 (`0x007E`)**: `WM_DISPLAYCHANGE`를 감지하여 디스플레이 설정 변경 시 1초 후 즉시 정보를 업데이트합니다.

## 확장성 및 개선 제안
1. **커스텀 마진 설정**: 현재 하드코딩된 `margin := 5`를 상수로 분리하여 사용자가 조절 가능하게 변경.
2. **볼륨 조절 단위**: 한 번의 스크롤당 변경되는 볼륨 단위를 설정할 수 있는 기능 추가.
3. **트레이 아이콘 메뉴**: 스크립트 일시 중지, 설정 변경 등을 위한 Tray Menu 구현.

---
**작성일**: 2025-12-19
**버전**: v1.0.0
